# OfficeHUB 業務統合システム 構想・設計書

---

## 1. 概要と目的

本システムは、福祉事業所における日々の業務（出退勤・営業・支援記録・利用者管理・経理処理等）を、LINE・Firebase・Googleサービスを活用して一元管理・自動化することを目的とする。

- 手入力・紙管理からの脱却
- 不正防止、業務の透明化
- 管理者の判断支援と効率化
- データの集約・帳票出力・通知の自動化

---

## 2. 現行機能一覧

### 2.1 出退勤管理

- LINE Bot＋QRによる打刻（出勤・退勤・有休・欠勤）
- GASでスプレッドシートへ記録（status, full, logs）
- QR発行時点でもログ記録（不正防止）
- 今後：Firestore移行・月次PDF出力・ステータス表示・未打刻アラート・端末識別対応

### 2.2 営業報告管理

- 営業活動をフォームで記録（訪問先・担当者・内容・写真）
- Firestore＋Storageに保存予定
- 管理者が承認すると「勤務延長」として退勤修正
- LINE通知で管理者報告も可

### 2.3 出欠予定と実績管理

- LINEリッチメニューから、月末に翌月の出欠予定を入力
- 出席実績と照合し、出席率・コマ数を計算
- 日報的にLINEグループへ自動報告

### 2.4 支援記録管理

- 支援記録をフォームで記録・PDF化して印刷可能に
- Firestoreベースで蓄積し、記録の履歴管理も視野
- 利用者ごとの紐づけが必要（利用者DBが前提）

### 2.5 利用者CRMと進捗管理

- 流れ：受付 → 見学 → 体験 → 利用意思 → 契約 → 利用 → 卒業・定着支援
- 各フェーズの履歴と状況を記録
- 利用者DBには、住所・電話・銀行口座情報（厚生訓練費用関連）を含む
- 契約や講座ごとの帳票にも対応予定

### 2.6 講座・アンケート管理

- 各種講座ごとにアンケート回収
- 利用者IDに紐づけて保存・分析
- 講座実施報告と連動したレポートにも活用

### 2.7 通知・報告（LINE連携）

- 出退勤・営業・支援記録などの必要情報を、管理LINEグループへ自動通知
- 営業報告の承認通知や日報的通知も含む

### 2.8 経費請求とドキュメント管理

- 経費の請求書をGoogle Driveにアップロード
- LINE BOT経由でファイルアップ → 指定フォルダに保存
- 管理用URLを一覧で表示 → 経理担当が一括確認可能に

---

## 3. 技術スタックと運用方針（予定）

| 項目 | 技術候補 |
|------|----------|
| Web UI | PWA（React or Vue） |
| データベース | Firestore（NoSQL） |
| ストレージ | Firebase Storage |
| 帳票出力 | jsPDF / pdf-lib |
| 認証 | Firebase Authentication（将来的に役割管理） |
| 通知 | LINE Messaging API／LINEグループ通知 |
| バックアップ | 必要に応じてスプレッドシートと連携も残す |

---

## 4. Firestore データ構造（予定）

### 出退勤記録
- `attendance_logs` コレクション
  - `name`, `status`, `timestamp`, `userId`, `deviceId`, `approvedBy`, `corrections` など

### 営業報告
- `sales_reports`
  - `visitTo`, `personInCharge`, `content`, `images`, `location`, `submittedAt`, `approvedAt`

### 利用者DB
- `users`
  - `name`, `status`, `address`, `phone`, `bankInfo`, `joinedAt`, `supportHistory` など

### 支援記録
- `support_logs`
  - `userId`, `date`, `content`, `author`, `pdfLink`, `createdAt`

---

## 5. システム間連携と拡張性

- LINEからの打刻・報告・通知をすべて入口とし、Firestore中心に集約
- 出欠予定やアンケートなどもFirebaseフォーム・LINE UIから入力
- 月次・日次処理はPDF・通知形式で出力／レポート連携
- 今後支援記録や定着支援などを統合し、利用者ごとの全記録を一元管理

---

## 6. 運用上の注意点と課題

- 利用者情報の機密性保持（プライバシーポリシー設計）
- データバックアップとログの保持
- 承認や修正処理の履歴記録（監査性確保）
- 運用者・管理者の役割設計とアクセス権限分離
- 月次帳票の誤差検知・修正手段（手動介入フローの整備）

---

## 7. 今後のステップ・開発ロードマップ

1. Firestoreと現行スプレッドシートの併用設計
2. 出退勤のUIをPWA化／Firestore記録へ
3. 月次タイムカードPDF出力機能の実装
4. 営業報告フォームと管理者承認フロー構築
5. 出欠予定カレンダー＋照合システム設計
6. 支援記録フォームの作成とPDF出力対応
7. 利用者DB・CRM・帳票テンプレート整備
8. 経費ドライブ管理・BOTアップロード導入

---

## 営業報告フォーム構想（2025年4月）

### 【目的】
現場での営業活動をより正確に記録・証拠化するため、営業開始・終了を2段階で報告するシステムを構築する。

---

### 【ステップ構成】

#### ▶️ Step1：営業開始（営業先到着時）
- フォームで「営業先名」を入力
- 入力時に現在の時刻と位置情報を自動記録
- 記録後、自動的に営業内容入力ページへ遷移

#### ▶️ Step2：営業終了（内容記録）
- Step1で入力した営業先名を保持
- 入力項目：
  - 担当者名
  - 営業内容（例：リーフレット設置、口頭説明など）
  - 写真のアップロード（1枚以上）
  - 備考欄（任意）

---

### 【拡張構想】

- 入力された営業先名に対して過去の履歴をDB検索
  - 「○月○日に訪問済みです」と表示
  - 1か月以内の再訪問であれば警告表示（別の訪問先を提案）

- 住所補完（将来的に逆ジオコーディング）
  - 位置情報をもとに自動で住所取得（Google API予定）

- 営業終了報告時にLINEグループ通知（営業管理者へ）

---

### 【データベース構成（案）】

コレクション：`visit_history`

| フィールド       | 型        | 説明                     |
|------------------|-----------|--------------------------|
| name             | string    | 営業先名                 |
| timestamp        | string    | 営業開始時刻             |
| latitude         | string    | 緯度                     |
| longitude        | string    | 経度                     |
| representative   | string    | 担当者名（後入力）       |
| content          | string    | 営業内容（後入力）       |
| photoUrl         | string    | 写真URL（後入力）        |
| submittedAt      | string    | 営業報告提出時刻         |

---

